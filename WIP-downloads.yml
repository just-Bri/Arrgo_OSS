servies:
  arrgo_gluetun:
    image: qmcgaw/gluetun:latest
    container_name: arrgo_gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    ports:
      - 8080:8080 # qBittorrent WebUI
      - 6881:6881 # qBittorrent TCP
      - 6881:6881/udp # qBittorrent UDP
    volumes:
      - /mnt/user/appdata/gluetun:/gluetun
    environment:
      # ProtonVPN settings
      - VPN_SERVICE_PROVIDER=protonvpn
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY=yANXWzz1roPzLKhsFBapDk4yzr9xKQZ4HKlUSojAk1s=
      - WIREGUARD_ADDRESSES=10.2.0.2/32
      - SERVER_COUNTRIES=United States
      # Port forwarding
      - VPN_PORT_FORWARDING=on
      - VPN_PORT_FORWARDING_PROVIDER=protonvpn
      # Firewall - allow local network
      - FIREWALL_OUTBOUND_SUBNETS=192.168.10.0/24
      # Timezone
      - TZ=America/Los_Angeles
      # Health check
      - HEALTH_VPN_DURATION_INITIAL=30s
    networks:
      - internal
    restart: unless-stopped
    healthcheck:
      test:
        - CMD
        - ping
        - -c
        - "1"
        - 1.1.1.1
      interval: 30s
      timeout: 10s
      retries: 3
    labels:
      net.unraid.docker.shell: bash
      io.hass.type: addon
  arrgo_qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: arrgo_qbittorrent
    network_mode: service:arrgo_gluetun
    depends_on:
      arrgo_gluetun:
        condition: service_healthy
    environment:
      - PUID=99
      - PGID=100
      - TZ=America/Los_Angeles
      - WEBUI_PORT=8080
    volumes:
      - /mnt/user/appdata/dockge/stacks/arrgo/qbittorrent/config:/config
      - /mnt/user/appdata/dockge/stacks/arrgo/qbittorrent/data/torrents:/mnt/incoming
    restart: unless-stopped
    labels:
      net.unraid.docker.managed: qbittorrent
      net.unraid.docker.webui: http://192.168.10.11:8080