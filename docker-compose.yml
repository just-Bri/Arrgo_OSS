services:
  arrgo-app:
    build:
      context: .
      args:
        - BUILD_VERSION=2
    container_name: arrgo-app
    ports:
      - "5003:5003"
    environment:
      - DATABASE_URL=postgres://arrgo:arrgo@arrgo-db:5432/arrgo?sslmode=disable
      - SESSION_SECRET=change-me-in-production
      - PORT=5003
      - ENV=development
      - DEBUG=true
      - PUID=99
      - PGID=100
      - GOLOG_LOG_LEVEL=debug
      - MOVIES_PATH=/mnt/movies
      - TV_SHOWS_PATH=/mnt/tv
      - INCOMING_PATH=/mnt/incoming
      - TMDB_API_KEY=${TMDB_API_KEY}
      - TVDB_API_KEY=${TVDB_API_KEY}
    depends_on:
      - arrgo-db
    volumes:
      - ./server/templates:/root/templates:ro
      - ./server/static:/root/static:ro
      - ./posters:/root/data/posters
      - /mnt/user/media/movies:/mnt/movies
      - /mnt/user/media/shows:/mnt/tv
      - /mnt/user/torrs/arrgo-incoming:/mnt/incoming
    restart: unless-stopped

  arrgo-db:
    image: postgres:16-alpine
    container_name: arrgo-db
    environment:
      - POSTGRES_USER=arrgo
      - POSTGRES_PASSWORD=arrgo
      - POSTGRES_DB=arrgo
    volumes:
      - arrgo-db-data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U arrgo -d arrgo"]
      interval: 5s
      timeout: 5s
      retries: 5
    restart: unless-stopped

volumes:
  arrgo-db-data:

